{% extends "base.html" %}
{% block title %}–†–µ–π—Ç–∏–Ω–≥ - Python Master{% endblock %}
{% block content %}
<div>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; flex-wrap: wrap; gap: 20px;">
        <div>
            <h1 style="color: var(--dark); margin-bottom: 10px; font-size: 2.5rem;">
                <i class="fas fa-trophy" style="color: var(--warning); margin-right: 15px;"></i>
                –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
            </h1>
            <p style="color: var(--gray); font-size: 1.1rem;">–¢–æ–ø-20 –ª—É—á—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ Python Master</p>
        </div>

        <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
            <div style="background: linear-gradient(135deg, var(--warning), #d97706); color: white; padding: 10px 20px; border-radius: 10px; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-crown"></i>
                –¢–æ–ø-20 –∏–≥—Ä–æ–∫–æ–≤
            </div>
            <a href="/dashboard" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> –ö –æ–±—É—á–µ–Ω–∏—é
            </a>
        </div>
    </div>

    <!-- –í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è -->
    {% set user_position = none %}
    {% set user_leader = none %}
    {% for leader in leaders %}
        {% if leader.username == session.username %}
            {% set user_position = loop.index %}
            {% set user_leader = leader %}
        {% endif %}
    {% endfor %}

    {% if user_position and user_leader %}
    <div class="card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-left: 4px solid var(--primary); margin-bottom: 30px;">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700;">
                    #{{ user_position }}
                </div>
                <div>
                    <h3 style="color: var(--dark); margin-bottom: 5px;">–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è: {{ user_position }}</h3>
                    <p style="color: var(--gray); font-size: 14px;">–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –æ–±—É—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å—Å—è –≤—ã—à–µ!</p>
                </div>
            </div>
            <div style="display: flex; gap: 25px; text-align: center; flex-wrap: wrap;">
                <div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--primary);">{{ user_leader.experience }}</div>
                    <div style="font-size: 12px; color: var(--gray);">–í–∞—à –æ–ø—ã—Ç</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--success);">{{ user_leader.level }}</div>
                    <div style="font-size: 12px; color: var(--gray);">–í–∞—à —É—Ä–æ–≤–µ–Ω—å</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--warning);">{{ user_leader.completed_lessons or 0 }}</div>
                    <div style="font-size: 12px; color: var(--gray);">–£—Ä–æ–∫–æ–≤</div>
                </div>
                {% if user_leader.daily_streak and user_leader.daily_streak > 0 %}
                <div>
                    <div style="font-size: 24px; font-weight: 700; color: #f59e0b;">{{ user_leader.daily_streak }}</div>
                    <div style="font-size: 12px; color: var(--gray);">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
    <div class="card">
        <div class="table-container" style="overflow-x: auto; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);">
            <table style="width: 100%; background: white; border-radius: 12px; overflow: hidden; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="background: #f8fafc; padding: 18px; text-align: left; font-weight: 600; color: var(--gray); border-bottom: 2px solid #e2e8f0; width: 80px;">–ú–µ—Å—Ç–æ</th>
                        <th style="background: #f8fafc; padding: 18px; text-align: left; font-weight: 600; color: var(--gray); border-bottom: 2px solid #e2e8f0;">–ò–≥—Ä–æ–∫</th>
                        <th style="background: #f8fafc; padding: 18px; text-align: left; font-weight: 600; color: var(--gray); border-bottom: 2px solid #e2e8f0; width: 100px;">–£—Ä–æ–≤–µ–Ω—å</th>
                        <th style="background: #f8fafc; padding: 18px; text-align: left; font-weight: 600; color: var(--gray); border-bottom: 2px solid #e2e8f0; width: 120px;">–û–ø—ã—Ç</th>
                        <th style="background: #f8fafc; padding: 18px; text-align: left; font-weight: 600; color: var(--gray); border-bottom: 2px solid #e2e8f0; width: 100px;">–£—Ä–æ–∫–∏</th>
                        <th style="background: #f8fafc; padding: 18px; text-align: left; font-weight: 600; color: var(--gray); border-bottom: 2px solid #e2e8f0; width: 120px;">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</th>
                        <th style="background: #f8fafc; padding: 18px; text-align: left; font-weight: 600; color: var(--gray); border-bottom: 2px solid #e2e8f0; width: 150px;">–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for leader in leaders %}
                    <tr {% if leader.username == session.username %}style="background: rgba(102, 126, 234, 0.05);"{% endif %}>
                        <td style="padding: 18px; border-bottom: 1px solid #e2e8f0;">
                            {% if loop.index == 1 %}
                                <div style="background: linear-gradient(135deg, #FFD700, #FFA500); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin: 0 auto; font-size: 20px;">
                                    ü•á
                                </div>
                            {% elif loop.index == 2 %}
                                <div style="background: linear-gradient(135deg, #C0C0C0, #A0A0A0); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin: 0 auto; font-size: 20px;">
                                    ü•à
                                </div>
                            {% elif loop.index == 3 %}
                                <div style="background: linear-gradient(135deg, #CD7F32, #A0522D); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin: 0 auto; font-size: 20px;">
                                    ü•â
                                </div>
                            {% else %}
                                <div style="background: #f1f5f9; color: var(--gray); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin: 0 auto; font-size: 18px;">
                                    {{ loop.index }}
                                </div>
                            {% endif %}
                        </td>
                        <td style="padding: 18px; border-bottom: 1px solid #e2e8f0;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 20px;">
                                    {{ leader.username[:1].upper() }}
                                </div>
                                <div>
                                    <div style="font-weight: 600; color: var(--dark); font-size: 16px;">
                                        {{ leader.username }}
                                        {% if leader.username == session.username %}
                                        <span style="background: var(--primary); color: white; padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-left: 8px;">–í—ã</span>
                                        {% endif %}
                                    </div>
                                    <div style="font-size: 13px; color: var(--gray); margin-top: 3px;">
                                        {% set total_lessons = 30 %}
                                        {% set progress = (leader.completed_lessons or 0) / total_lessons * 100 %}
                                        {% if progress <= 20 %}
                                            üå± –ù–æ–≤–∏—á–æ–∫
                                        {% elif progress <= 40 %}
                                            üìò –£—á–µ–Ω–∏–∫
                                        {% elif progress <= 60 %}
                                            ‚ö° –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
                                        {% elif progress <= 80 %}
                                            üöÄ –≠–∫—Å–ø–µ—Ä—Ç
                                        {% else %}
                                            üéØ –ú–∞—Å—Ç–µ—Ä
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 18px; border-bottom: 1px solid #e2e8f0;">
                            <div style="background: rgba(102, 126, 234, 0.1); color: var(--primary); padding: 8px 16px; border-radius: 20px; font-weight: 600; display: inline-block; font-size: 15px;">
                                {{ leader.level }}
                            </div>
                        </td>
                        <td style="padding: 18px; border-bottom: 1px solid #e2e8f0;">
                            <div style="font-weight: 700; color: var(--dark); font-size: 18px;">
                                {{ leader.experience }}
                            </div>
                            <div style="font-size: 12px; color: var(--gray);">–æ–ø—ã—Ç–∞</div>
                        </td>
                        <td style="padding: 18px; border-bottom: 1px solid #e2e8f0;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-check-circle" style="color: var(--success);"></i>
                                <span style="font-weight: 600; color: var(--dark); font-size: 16px;">{{ leader.completed_lessons or 0 }}</span>
                                <span style="color: var(--gray); font-size: 14px;">/30</span>
                            </div>
                        </td>
                        <td style="padding: 18px; border-bottom: 1px solid #e2e8f0;">
                            {% if leader.daily_streak and leader.daily_streak > 0 %}
                            <div style="display: flex; align-items: center; gap: 10px; background: rgba(245, 158, 11, 0.1); padding: 8px 16px; border-radius: 20px;">
                                <i class="fas fa-fire" style="color: var(--warning);"></i>
                                <span style="font-weight: 600; color: var(--warning);">{{ leader.daily_streak }}</span>
                                <span style="color: var(--gray); font-size: 13px;">–¥–Ω–µ–π</span>
                            </div>
                            {% else %}
                            <span style="color: var(--gray); font-size: 14px;">‚Äî</span>
                            {% endif %}
                        </td>
                        <td style="padding: 18px; border-bottom: 1px solid #e2e8f0;">
                            {% set total_lessons = 30 %}
                            {% set progress = (leader.completed_lessons or 0) / total_lessons * 100 %}
                            <div style="width: 140px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 12px; color: var(--gray);">
                                    <span>0%</span>
                                    <span>{{ progress|int }}%</span>
                                    <span>100%</span>
                                </div>
                                <div style="height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; margin-bottom: 5px;">
                                    <div style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 4px; width: {{ progress|int }}%;"></div>
                                </div>
                                <div style="font-size: 12px; color: var(--gray); text-align: center;">
                                    {% if progress < 20 %}–ù–∞—á–∞–ª–æ –ø—É—Ç–∏
                                    {% elif progress < 40 %}–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º
                                    {% elif progress < 60 %}–•–æ—Ä–æ—à–∏–π —Ç–µ–º–ø
                                    {% elif progress < 80 %}–ü–æ—á—Ç–∏ —É —Ü–µ–ª–∏
                                    {% elif progress < 100 %}–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä—ã–≤–æ–∫
                                    {% else %}–ö—É—Ä—Å –∑–∞–≤–µ—Ä—à–µ–Ω! üéâ
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 40px;">
        <div class="card" style="text-align: center;">
            <div style="font-size: 36px; color: var(--primary); margin-bottom: 15px;">
                <i class="fas fa-users"></i>
            </div>
            <h3 style="color: var(--dark); margin-bottom: 10px;">–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤</h3>
            <div style="font-size: 42px; font-weight: 700; color: var(--dark);">{{ leaders|length }}+</div>
            <p style="color: var(--gray); font-size: 14px; margin-top: 10px;">–ê–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ</p>
        </div>

        <div class="card" style="text-align: center;">
            <div style="font-size: 36px; color: var(--success); margin-bottom: 15px;">
                <i class="fas fa-chart-line"></i>
            </div>
            <h3 style="color: var(--dark); margin-bottom: 10px;">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å</h3>
            <div style="font-size: 42px; font-weight: 700; color: var(--dark);">
                {{ (leaders|map(attribute='level')|sum / leaders|length)|int if leaders|length > 0 else 0 }}
            </div>
            <p style="color: var(--gray); font-size: 14px; margin-top: 10px;">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–æ–≤</p>
        </div>

        <div class="card" style="text-align: center;">
            <div style="font-size: 36px; color: var(--warning); margin-bottom: 15px;">
                <i class="fas fa-crown"></i>
            </div>
            <h3 style="color: var(--dark); margin-bottom: 10px;">–õ–∏–¥–µ—Ä –º–µ—Å—è—Ü–∞</h3>
            <div style="font-size: 24px; font-weight: 700; color: var(--dark);">
                {{ leaders[0].username if leaders else '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö' }}
            </div>
            <p style="color: var(--gray); font-size: 14px; margin-top: 10px;">{{ leaders[0].experience if leaders else 0 }} XP</p>
        </div>

        <div class="card" style="text-align: center;">
            <div style="font-size: 36px; color: var(--danger); margin-bottom: 15px;">
                <i class="fas fa-fire"></i>
            </div>
            <h3 style="color: var(--dark); margin-bottom: 10px;">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–µ—Ä–∏—è</h3>
            <div style="font-size: 42px; font-weight: 700; color: var(--dark);">
                {{ leaders|map(attribute='daily_streak')|max|default(0) }}
            </div>
            <p style="color: var(--gray); font-size: 14px; margin-top: 10px;">–î–Ω–µ–π –æ–±—É—á–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥</p>
        </div>
    </div>

    <!-- –ö–∞–∫ –ø–æ–¥–Ω—è—Ç—å—Å—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ -->
    <div class="card" style="margin-top: 40px;">
        <h3 style="color: var(--dark); margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid #e2e8f0; font-size: 1.5rem;">
            <i class="fas fa-rocket" style="color: var(--primary); margin-right: 12px;"></i>
            –ö–∞–∫ –ø–æ–¥–Ω—è—Ç—å—Å—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ?
        </h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px;">
            <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
                <div style="font-size: 48px; margin-bottom: 20px;">üìö</div>
                <h4 style="color: var(--dark); margin-bottom: 12px;">–ó–∞–≤–µ—Ä—à–∞–π—Ç–µ —É—Ä–æ–∫–∏</h4>
                <p style="color: var(--gray); font-size: 14px; line-height: 1.5;">
                    –ö–∞–∂–¥—ã–π —É—Ä–æ–∫ –¥–∞–µ—Ç –æ–ø—ã—Ç (XP). –ß–µ–º –±–æ–ª—å—à–µ —É—Ä–æ–∫–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ, —Ç–µ–º –≤—ã—à–µ –≤–∞—à —Ä–µ–π—Ç–∏–Ω–≥.
                </p>
            </div>

            <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
                <div style="font-size: 48px; margin-bottom: 20px;">üî•</div>
                <h4 style="color: var(--dark); margin-bottom: 12px;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å–µ—Ä–∏—é</h4>
                <p style="color: var(--gray); font-size: 14px; line-height: 1.5;">
                    –ó–∞—Ö–æ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å —Å–≤–æ—é —Å–µ—Ä–∏—é. –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–∏–∏ –¥–∞—é—Ç –±–æ–Ω—É—Å—ã.
                </p>
            </div>

            <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
                <div style="font-size: 48px; margin-bottom: 20px;">‚≠ê</div>
                <h4 style="color: var(--dark); margin-bottom: 12px;">–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —É—Ä–æ–∫–∏</h4>
                <p style="color: var(--gray); font-size: 14px; line-height: 1.5;">
                    –°–ª–æ–∂–Ω—ã–µ —É—Ä–æ–∫–∏ (—É—Ä–æ–≤–Ω–∏ 4-5) –¥–∞—é—Ç –±–æ–ª—å—à–µ –æ–ø—ã—Ç–∞ –∏ –±—ã—Å—Ç—Ä–µ–µ –ø–æ–≤—ã—à–∞—é—Ç –≤–∞—à —Ä–∞–Ω–≥.
                </p>
            </div>

            <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
                <div style="font-size: 48px; margin-bottom: 20px;">‚ö°</div>
                <h4 style="color: var(--dark); margin-bottom: 12px;">–ë—É–¥—å—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã</h4>
                <p style="color: var(--gray); font-size: 14px; line-height: 1.5;">
                    –ß–µ–º –±–æ–ª—å—à–µ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–µ–µ –≤—ã —É—á–∏—Ç–µ—Å—å, —Ç–µ–º –≤—ã—à–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç–µ—Å—å –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ.
                </p>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px;">
            <a href="/dashboard" class="btn btn-primary" style="padding: 18px 50px; font-size: 17px; font-weight: 600;">
                <i class="fas fa-play"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –∏ –ø–æ–¥–Ω—è—Ç—å—Å—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const currentUserRow = document.querySelector('tr[style*="background: rgba(102, 126, 234, 0.05)"]');
        if (currentUserRow) {
            currentUserRow.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            setTimeout(() => {
                currentUserRow.style.transition = 'all 0.5s ease';
                currentUserRow.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.2)';

                setTimeout(() => {
                    currentUserRow.style.boxShadow = 'none';
                }, 2000);
            }, 1000);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ
        const progressBars = document.querySelectorAll('td div[style*="height: 8px;"] div');
        progressBars.forEach((bar, index) => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
                bar.style.transition = 'width 1s ease';
            }, 300 + index * 100);
        });
    });
</script>

<style>
    .card {
        background: white;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
    }

    .table-container {
        border-radius: 12px;
        overflow: hidden;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th {
        background: #f8fafc;
        padding: 18px;
        text-align: left;
        font-weight: 600;
        color: var(--gray);
        border-bottom: 2px solid #e2e8f0;
    }

    td {
        padding: 18px;
        border-bottom: 1px solid #e2e8f0;
    }

    tr:hover {
        background: #f8fafc;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        border-radius: 4px;
        transition: width 1s ease;
    }
</style>
{% endblock %}