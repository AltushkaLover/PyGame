{% extends "base.html" %}
{% block title %}–ü—Ä–æ—Ñ–∏–ª—å - Python Master{% endblock %}
{% block content %}
<div>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 40px; flex-wrap: wrap; gap: 20px;">
        <div>
            <h1 style="color: var(--dark); margin-bottom: 10px; font-size: 2.5rem;">
                <i class="fas fa-user-circle" style="color: var(--primary); margin-right: 15px;"></i>
                –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å
            </h1>
            <p style="color: var(--gray); font-size: 1.1rem;">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</p>
        </div>

        <div style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 15px 25px; border-radius: 15px; text-align: center; min-width: 180px;">
            <div style="font-size: 12px; opacity: 0.9;">–¢–µ–∫—É—â–∏–π —Ä–∞–Ω–≥</div>
            <div style="font-size: 28px; font-weight: 700;">
                {% if user.level <= 5 %}
                    üå± –ù–æ–≤–∏—á–æ–∫
                {% elif user.level <= 10 %}
                    üìò –£—á–µ–Ω–∏–∫
                {% elif user.level <= 15 %}
                    ‚ö° –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
                {% elif user.level <= 20 %}
                    üöÄ –≠–∫—Å–ø–µ—Ä—Ç
                {% elif user.level <= 25 %}
                    üéØ –ú–∞—Å—Ç–µ—Ä
                {% else %}
                    üëë –ì—É—Ä—É Python
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px; margin-bottom: 40px;">
        <!-- –ê–≤–∞—Ç–∞—Ä –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="card" style="text-align: center;">
            <div style="width: 120px; height: 120px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 48px; color: white;">
                <i class="fas fa-user"></i>
            </div>
            <h2 style="color: var(--dark); margin-bottom: 10px;">{{ user.username }}</h2>
            <p style="color: var(--gray); margin-bottom: 20px;">
                <i class="fas fa-calendar" style="margin-right: 5px;"></i>
                –£—á–∞—Å—Ç–Ω–∏–∫ —Å {{ user.created_at[:10] if user.created_at else '–Ω–µ–¥–∞–≤–Ω–æ' }}
            </p>
            <div class="level-badge" style="font-size: 18px; padding: 10px 20px; display: inline-block;">
                <i class="fas fa-star"></i> –£—Ä–æ–≤–µ–Ω—å {{ user.level }}
            </div>

            {% if user.daily_streak and user.daily_streak > 0 %}
            <div style="margin-top: 20px; padding: 10px; background: rgba(245, 158, 11, 0.1); border-radius: 10px; display: inline-flex; align-items: center; gap: 8px;">
                <i class="fas fa-fire" style="color: var(--warning);"></i>
                <span style="font-weight: 600; color: var(--warning);">{{ user.daily_streak }} –¥–Ω–µ–π</span>
                <span style="color: var(--gray); font-size: 14px;">–ø–æ–¥—Ä—è–¥</span>
            </div>
            {% endif %}
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div>
            <h3 style="color: var(--dark); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0;">
                <i class="fas fa-chart-bar" style="color: var(--primary); margin-right: 10px;"></i>
                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è
            </h3>

            <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="stat-card" style="text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                    <div class="stat-icon" style="font-size: 32px; color: var(--primary); margin-bottom: 12px;">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="stat-number" style="font-size: 36px; font-weight: 700; color: var(--dark); margin-bottom: 8px;">
                        {{ user.experience }}
                    </div>
                    <div class="stat-label" style="color: var(--gray); font-size: 14px;">–í—Å–µ–≥–æ –æ–ø—ã—Ç–∞ (XP)</div>
                </div>

                <div class="stat-card" style="text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                    <div class="stat-icon" style="font-size: 32px; color: var(--success); margin-bottom: 12px;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-number" style="font-size: 36px; font-weight: 700; color: var(--dark); margin-bottom: 8px;">
                        {{ stats.completed_lessons or 0 }}
                    </div>
                    <div class="stat-label" style="color: var(--gray); font-size: 14px;">–£—Ä–æ–∫–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                </div>

                <div class="stat-card" style="text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                    <div class="stat-icon" style="font-size: 32px; color: var(--warning); margin-bottom: 12px;">
                        <i class="fas fa-gem"></i>
                    </div>
                    <div class="stat-number" style="font-size: 36px; font-weight: 700; color: var(--dark); margin-bottom: 8px;">
                        {{ stats.total_score or 0 }}
                    </div>
                    <div class="stat-label" style="color: var(--gray); font-size: 14px;">XP –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                </div>

                <div class="stat-card" style="text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                    <div class="stat-icon" style="font-size: 32px; color: #3b82f6; margin-bottom: 12px;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-number" style="font-size: 36px; font-weight: 700; color: var(--dark); margin-bottom: 8px;">
                        {{ stats.avg_score|int if stats.avg_score else 0 }}
                    </div>
                    <div class="stat-label" style="color: var(--gray); font-size: 14px;">–°—Ä–µ–¥–Ω–∏–π XP –∑–∞ —É—Ä–æ–∫</div>
                </div>
            </div>

            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è -->
            <div class="card" style="margin-bottom: 20px;">
                <h4 style="color: var(--dark); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-arrow-up" style="color: var(--primary);"></i>
                    –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —É—Ä–æ–≤–Ω—è {{ user.level + 1 }}
                </h4>
                <div class="progress-container">
                    <div class="progress-label" style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; color: var(--gray);">
                        <span>{{ user.experience % 100 }}/100 XP</span>
                        <span>–û—Å—Ç–∞–ª–æ—Å—å: {{ 100 - (user.experience % 100) }} XP</span>
                    </div>
                    <div class="progress-bar" style="width: 100%; height: 12px; background: #e2e8f0; border-radius: 6px; overflow: hidden;">
                        <div class="progress-fill" style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 6px; width: {{ user.experience % 100 }}%;"></div>
                    </div>
                </div>
                <p style="color: var(--gray); font-size: 14px; margin-top: 10px;">
                    <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                    –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –æ–ø—ã—Ç –∑–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π —É—Ä–æ–∫. –ö–∞–∂–¥—ã–µ 100 XP –ø–æ–≤—ã—à–∞—é—Ç –≤–∞—à —É—Ä–æ–≤–µ–Ω—å.
                </p>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
    {% if difficulty_stats %}
    <div class="card">
        <h3 style="color: var(--dark); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0;">
            <i class="fas fa-signal" style="color: var(--primary); margin-right: 10px;"></i>
            –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        </h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            {% for stat in difficulty_stats %}
            <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border-left: 4px solid
                {% if stat.difficulty == 1 %}var(--success)
                {% elif stat.difficulty == 2 %}#3b82f6
                {% elif stat.difficulty == 3 %}var(--warning)
                {% elif stat.difficulty == 4 %}#8b5cf6
                {% elif stat.difficulty == 5 %}var(--danger)
                {% else %}var(--primary){% endif %};">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <h4 style="color: var(--dark); margin-bottom: 5px;">
                            {% if stat.difficulty == 1 %}üå± –ù–∞—á–∏–Ω–∞—é—â–∏–π
                            {% elif stat.difficulty == 2 %}üìò –ü—Ä–æ—Å—Ç–æ–π
                            {% elif stat.difficulty == 3 %}‚ö° –°—Ä–µ–¥–Ω–∏–π
                            {% elif stat.difficulty == 4 %}üöÄ –°–ª–æ–∂–Ω—ã–π
                            {% elif stat.difficulty == 5 %}üéØ –≠–∫—Å–ø–µ—Ä—Ç
                            {% endif %}
                        </h4>
                        <p style="color: var(--gray); font-size: 14px;">–£—Ä–æ–∫–∏ —É—Ä–æ–≤–Ω—è {{ stat.difficulty }}</p>
                    </div>
                    <div style="font-size: 24px; font-weight: 700; color:
                        {% if stat.difficulty == 1 %}var(--success)
                        {% elif stat.difficulty == 2 %}#3b82f6
                        {% elif stat.difficulty == 3 %}var(--warning)
                        {% elif stat.difficulty == 4 %}#8b5cf6
                        {% elif stat.difficulty == 5 %}var(--danger)
                        {% else %}var(--primary){% endif %}">
                        {{ stat.completed or 0 }}/{{ stat.total or 0 }}
                    </div>
                </div>

                <div class="progress-bar" style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                    <div class="progress-fill" style="height: 100%; background:
                        {% if stat.difficulty == 1 %}var(--success)
                        {% elif stat.difficulty == 2 %}#3b82f6
                        {% elif stat.difficulty == 3 %}var(--warning)
                        {% elif stat.difficulty == 4 %}#8b5cf6
                        {% elif stat.difficulty == 5 %}var(--danger)
                        {% else %}var(--primary){% endif %};
                        border-radius: 4px; width: {% if stat.total > 0 %}{{ (stat.completed / stat.total * 100) }}{% else %}0{% endif %}%;">
                    </div>
                </div>

                <div style="text-align: center; color: var(--gray); font-size: 14px;">
                    {% if stat.total > 0 %}
                        {{ (stat.completed / stat.total * 100)|int }}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                    {% else %}
                        –ù–µ—Ç —É—Ä–æ–∫–æ–≤
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
    <div class="card" style="margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="color: var(--dark); display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-calendar-check" style="color: var(--success);"></i>
                –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            </h3>

            {% if user.daily_streak and user.daily_streak > 0 %}
            <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-fire"></i> –°–µ—Ä–∏—è: {{ user.daily_streak }} –¥–Ω–µ–π
            </div>
            {% endif %}
        </div>

        <div style="display: flex; flex-direction: column; gap: 15px;">
            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(245, 158, 11, 0.05); border-radius: 10px;">
                <div style="font-size: 24px; color: var(--warning);">üî•</div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: var(--dark);">
                        {% if user.daily_streak and user.daily_streak >= 7 %}
                        –û—Ç–ª–∏—á–Ω–∞—è —Å–µ—Ä–∏—è! –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ –µ—ë!
                        {% elif user.daily_streak and user.daily_streak > 0 %}
                        –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!
                        {% else %}
                        –ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ—é —Å–µ—Ä–∏—é –æ–±—É—á–µ–Ω–∏—è!
                        {% endif %}
                    </div>
                    <div style="font-size: 14px; color: var(--gray);">
                        {% if user.daily_streak and user.daily_streak > 0 %}
                        –í—ã —É—á–∏—Ç–µ—Å—å {{ user.daily_streak }} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
                        {% else %}
                        –ó–∞—Ö–æ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤
                        {% endif %}
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.05); border-radius: 10px;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">
                        +10%
                    </div>
                    <div style="font-size: 12px; color: var(--gray);">–ó–∞ 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥</div>
                </div>

                <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.05); border-radius: 10px;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">
                        +20%
                    </div>
                    <div style="font-size: 12px; color: var(--gray);">–ó–∞ 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                </div>

                <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.05); border-radius: 10px;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">
                        +50%
                    </div>
                    <div style="font-size: 12px; color: var(--gray);">–ó–∞ 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div style="display: flex; gap: 20px; margin-top: 40px; flex-wrap: wrap;">
        <a href="/dashboard" class="btn btn-primary" style="padding: 16px 30px;">
            <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–±—É—á–µ–Ω–∏—é
        </a>

        <a href="/leaderboard" class="btn btn-secondary" style="padding: 16px 30px;">
            <i class="fas fa-trophy"></i> –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
        </a>

        <a href="/achievements" class="btn btn-secondary" style="padding: 16px 30px;">
            <i class="fas fa-award"></i> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
        const progressBars = document.querySelectorAll('.progress-fill');
        progressBars.forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, 500);
        });
    });
</script>
{% endblock %}