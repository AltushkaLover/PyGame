{% extends "base.html" %}
{% block title %}–£—Ä–æ–∫–∏ - Python Master{% endblock %}
{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div style="margin-bottom: 30px;">
        <h1>–ü—Ä–∏–≤–µ—Ç, {{ user.username }}! üëã</h1>
        <p style="color: #666; font-size: 18px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Python Master</p>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 25px;">
            <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 24px; color: #4a6cf7; font-weight: bold;">{{ user.experience }}</div>
                <div style="color: #666; font-size: 14px;">–û–ø—ã—Ç (XP)</div>
            </div>

            <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 24px; color: #ff9800; font-weight: bold;">{{ user.level }}</div>
                <div style="color: #666; font-size: 14px;">–£—Ä–æ–≤–µ–Ω—å</div>
            </div>

            <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 24px; color: #4caf50; font-weight: bold;">{{ completed }}/{{ total }}</div>
                <div style="color: #666; font-size: 14px;">–£—Ä–æ–∫–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
            </div>

            <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 24px; color: #9c27b0; font-weight: bold;">{{ progress }}%</div>
                <div style="color: #666; font-size: 14px;">–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —É—Ä–æ–≤–Ω—è -->
    <div style="background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span style="font-weight: bold;">–£—Ä–æ–≤–µ–Ω—å {{ user.level }}</span>
            <span style="color: #666;">{{ user.experience % 100 }}/100 XP –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è</span>
        </div>
        <div style="height: 12px; background: #e9ecef; border-radius: 6px; overflow: hidden;">
            <div style="height: 100%; background: linear-gradient(90deg, #4a6cf7, #764ba2); width: {{ user.experience % 100 }}%; border-radius: 6px;"></div>
        </div>
    </div>

    <!-- –£—Ä–æ–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
    <h2 style="margin-bottom: 25px;">üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ä–æ–∫–∏</h2>

    {% if levels %}
        {% for difficulty, diff_lessons in levels.items()|sort %}
        <div style="margin-bottom: 40px;">
            <h3 style="margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eee;">
                {% if difficulty == 1 %}
                    üü¢ –ù–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å ({{ diff_lessons|length }} —É—Ä–æ–∫–æ–≤)
                {% elif difficulty == 2 %}
                    üîµ –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å ({{ diff_lessons|length }} —É—Ä–æ–∫–æ–≤)
                {% elif difficulty == 3 %}
                    üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å ({{ diff_lessons|length }} —É—Ä–æ–∫–æ–≤)
                {% elif difficulty == 4 %}
                    üü£ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å ({{ diff_lessons|length }} —É—Ä–æ–∫–æ–≤)
                {% else %}
                    üî¥ –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å ({{ diff_lessons|length }} —É—Ä–æ–∫–æ–≤)
                {% endif %}
            </h3>

            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">
                {% for lesson in diff_lessons %}
                <div style="background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                            border-left: 4px solid
                            {% if lesson.difficulty == 1 %}#4caf50
                            {% elif lesson.difficulty == 2 %}#2196f3
                            {% elif lesson.difficulty == 3 %}#ff9800
                            {% elif lesson.difficulty == 4 %}#9c27b0
                            {% else %}#f44336
                            {% endif %};">

                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: #333;">
                                –£—Ä–æ–∫ {{ lesson.order_num }}: {{ lesson.title }}
                            </h4>
                            <p style="color: #666; margin: 0; font-size: 14px;">
                                {{ lesson.description }}
                            </p>
                        </div>

                        {% if lesson.completed %}
                        <span style="background: #4caf50; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">
                            ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω
                        </span>
                        {% endif %}
                    </div>

                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <span style="background: #ff9800; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                            +{{ lesson.xp_reward }} XP
                        </span>

                        <span style="color: #666; font-size: 13px;">
                            <i class="fas fa-clock"></i>
                            {% if lesson.difficulty == 1 %}10-15 –º–∏–Ω
                            {% elif lesson.difficulty == 2 %}15-20 –º–∏–Ω
                            {% elif lesson.difficulty == 3 %}20-25 –º–∏–Ω
                            {% elif lesson.difficulty == 4 %}25-30 –º–∏–Ω
                            {% else %}30-40 –º–∏–Ω
                            {% endif %}
                        </span>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="color: #666; font-size: 13px;">
                            {% if lesson.completed %}
                            <span style="color: #4caf50;">
                                <i class="fas fa-trophy"></i> –ü–æ–ª—É—á–µ–Ω–æ: {{ lesson.score }} XP
                            </span>
                            {% else %}
                            <span>–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</span>
                            {% endif %}
                        </div>

                        {% if lesson.completed %}
                        <a href="/lesson/{{ lesson.id }}" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px;">
                            –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                        </a>
                        {% else %}
                        <a href="/lesson/{{ lesson.id }}" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">
                            –ù–∞—á–∞—Ç—å —É—Ä–æ–∫
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div style="background: white; border-radius: 10px; padding: 50px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div style="font-size: 48px; color: #ddd; margin-bottom: 20px;">üìö</div>
        <h3 style="color: #666; margin-bottom: 15px;">–ü–æ–∫–∞ –Ω–µ—Ç —É—Ä–æ–∫–æ–≤</h3>
        <p style="color: #999;">–£—Ä–æ–∫–∏ —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è</p>
    </div>
    {% endif %}

    <!-- –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; padding: 30px; margin-top: 50px; text-align: center;">
        <h3 style="margin-bottom: 15px;">
            {% if completed == 0 %}
            –ù–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–µ–≥–æ–¥–Ω—è! üöÄ
            {% elif completed < total %}
            –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! –¢—ã –Ω–∞ –ø—É—Ç–∏ –∫ —É—Å–ø–µ—Ö—É! üí™
            {% else %}
            –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢—ã –∑–∞–≤–µ—Ä—à–∏–ª –≤—Å–µ —É—Ä–æ–∫–∏! üèÜ
            {% endif %}
        </h3>
        <p style="opacity: 0.9; margin-bottom: 20px;">
            {% if completed == 0 %}
            –ù–∞—á–Ω–∏ —Å –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞ –∏ –æ—Ç–∫—Ä–æ–π –¥–ª—è —Å–µ–±—è –º–∏—Ä Python
            {% elif completed < total %}
            –¢—ã –∑–∞–≤–µ—Ä—à–∏–ª {{ completed }} –∏–∑ {{ total }} —É—Ä–æ–∫–æ–≤. –û—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ {{ total - completed }}!
            {% else %}
            –¢—ã –æ—Å–≤–æ–∏–ª –æ—Å–Ω–æ–≤—ã Python! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–∞–º
            {% endif %}
        </p>

        {% if completed < total %}
            {% set next_lesson = none %}
            {% for difficulty, diff_lessons in levels.items()|sort %}
                {% for lesson in diff_lessons %}
                    {% if not lesson.completed and not next_lesson %}
                        {% set next_lesson = lesson %}
                    {% endif %}
                {% endfor %}
            {% endfor %}

            {% if next_lesson %}
            <a href="/lesson/{{ next_lesson.id }}" class="btn" style="background: white; color: #667eea; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: bold;">
                {% if completed == 0 %}
                –ù–∞—á–∞—Ç—å –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫
                {% else %}
                –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —É—Ä–æ–∫–∞ {{ next_lesson.order_num }}
                {% endif %}
            </a>
            {% endif %}
        {% endif %}
    </div>
</div>

<style>
    .btn {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: bold;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-primary {
        background: #4a6cf7;
        color: white;
    }

    .btn-primary:hover {
        background: #3a5ce5;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(74, 108, 247, 0.3);
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
    }

    h1, h2, h3, h4 {
        color: #333;
    }
</style>

<script>
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
    document.addEventListener('DOMContentLoaded', function() {
        const lessonCards = document.querySelectorAll('div[style*="border-left: 4px solid"]');
        lessonCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';

            setTimeout(() => {
                card.style.transition = 'opacity 0.5s, transform 0.5s';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });
</script>
{% endblock %}